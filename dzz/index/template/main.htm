<!--{template lyear:header_simple_start}-->
<style>
	.card:hover {
		box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
	}
	.progress {
		align-items: center;
		background-color:transparent
	}
	.progress-inner {
		height: 10px;
		flex: 1;
		margin-right: 5px;
		background-color: #e9ecef;
		border-radius: 5px;
	}
	.progress-bar {
		transition: width 0.5s ease;
		height: 100%;
		border-radius: 5px;
	} 
	.recent-item {
		display: flex;
		align-items: center;
		padding: 0.75rem 1rem;
		border-bottom: 1px solid #e9ecef;
	}
	.recent-item:last-child {
		border-bottom: none;
	}
	.recent-img {
		margin-right: 1rem;
		width: 32px;
		text-align: center;
	}
	.ui-sortable-helper{
		width: 18rem;
		border:1px solid transparent;
		opacity: 0.6;
	}
	.ui-state-default{
		width: 18rem;
		display: inline-block;
		border:1px solid #e1e1e1;
		border-radius: 12px;
	}
	.card-market{-webkit-box-shadow:0 0 0 1px rgba(0,0,0,0.05),0 10px 20px 0 rgba(0,0,0,0.1);-moz-box-shadow:0 0 0 1px rgba(0,0,0,0.05),0 10px 20px 0 rgba(0,0,0,0.1);box-shadow:0 0 0 1px rgba(0,0,0,0.05),0 10px 20px 0 rgba(0,0,0,0.1)}
	.card-market:hover,.card-market:focus-within{box-shadow:0 0 0 2px #007bff,0 10px 20px 0 rgba(0,0,0,0.1);box-shadow:0 0 0 2px var(--bs-primary),0 10px 20px 0 rgba(0,0,0,0.1);transform:translatey(-5px)}
	.card-image{border-radius:10px;overflow:hidden;display:flex;justify-content:center;position:relative;align-items:center;width:100%}
	.card-image img{height:64px;width: 64px;}
</style>
<!--{template lyear:header_simple_noleft_end}-->
<main class="bs-main-container" style="padding-left: 0;">
	<div class="container-fluid">
		<div class="card bg-primary text-white d-flex flex-wrap justify-content-between">
			<div class="card-body">
				<div class="display-4 fs-4 fw-bold mb-1">{$_G['username']}，<span id="greeting">早上好！</span></div>
				<p class="text-gray-600">欢迎回到你的个人首页。登录时间：<!--{eval echo dgmdate($userstatus['lastvisit'])}-->。空间使用情况：$space['fusesize']/$space['fmaxspacesize']</p>
			</div>
		</div>
		<div class="card">
			<header class="card-header d-flex justify-content-between align-items-center">
				<div class="card-title">
					<div class="d-flex flex-wrap justify-between align-items-center fw-bold fs-4">
						<span id="current-date"></span>
						<span class="ps-2" id="weekday"></span>
						<div class="ps-2 text-primary">
							<span id="time">00:00:00</span>
						</div>
					</div>
				</div>
				<ul class="card-actions flex-wrap">
					<li><a href="javascript:;" id="format-24h" class="dcolor" title="24小时制"><i class="mdi mdi-clock-time-eight-outline"></i></a></li>
					<li><a href="javascript:;" id="format-12h" class="dcolor" title="12小时制"><i class="mdi mdi-clock-time-six-outline"></i></a></li>
					<li><a href="javascript:;" id="show-seconds" class="dcolor" title="显示秒"><i class="mdi mdi-av-timer"></i></a></li>
					<li><a href="javascript:;" class="card-btn-slide dcolor rotate-180"><i class="mdi mdi-chevron-up"></i></a></li>
				</ul>
			</header>
			<div class="card-body" style="display: none;">
				<div class="mb-1">
					<div class="text-muted">
						今日已经过去<span class="text-primary" id="day-hours">0</span>小时
					</div>
					<div class="progress">
						<div class="progress-inner">
							<div class="progress-bar progress-bar-striped progress-bar-animated" id="day-progress-bar" style="width: 0%"></div>
						</div>
						<div class="text-muted" id="day-progress-text">0%</div>
					</div>
				</div>
				<div class="mb-1">
					<div class="text-muted">
						本周已经过去<span class="text-primary" id="week-days">0</span>天
					</div>
					<div class="progress">
						<div class="progress-inner">
							<div class="progress-bar progress-bar-striped bg-warning progress-bar-animated" id="week-progress-bar" style="width: 0%"></div>
						</div>
						<div class="text-muted" id="week-progress-text">0%</div>
					</div>
				</div>
				<div class="mb-1">
					<div class="text-muted">
						本月已经过去<span class="text-primary" id="month-days">0</span>天
					</div>
					<div class="progress">
						<div class="progress-inner">
							<div class="progress-bar progress-bar-striped bg-danger progress-bar-animated" id="month-progress-bar" style="width: 0%"></div>
						</div>
						<div class="text-muted" id="month-progress-text">0%</div>
					</div>
				</div>
				<div class="mb-1">
					<div class="text-muted">
						今年已经过去<span class="text-primary" id="year-months">0</span>个月
					</div>
					<div class="progress">
						<div class="progress-inner">
							<div class="progress-bar progress-bar-striped bg-success progress-bar-animated" id="year-progress-bar" style="width: 0%"></div>
						</div>
						<div class="text-muted" id="year-progress-text">0%</div>
					</div>
				</div>
			</div>
		</div>
		<div class="card" id="statis">
			<header class="card-header d-flex justify-content-between">
				<div class="card-title"><i class="mdi mdi-file-clock-outline me-2"></i>最近访问</div>
				<ul class="card-actions">
				<li><a href="javascript:;" class="dcolor card-btn-close"><i class="mdi mdi-close"></i></a></li>
				<li><a href="javascript:;" class="dcolor card-btn-slide"><i class="mdi mdi-chevron-up"></i></a></li>
				<li><a href="javascript:;" class="dcolor card-btn-fullscreen"><i class="mdi mdi-fullscreen"></i></a></li>
				<li><a href="{MOD_URL}&do=statis" class="dcolor card-btn-reload"><i class="mdi mdi-refresh"></i></a></li>
				</ul>
			</header>
			<div class="card-body">
				<a href="{MOD_URL}&do=statis" class="btn btn-primary card-btn-reload d-grid">点击查看</a>
			</div>
		</div>
		<!--{if $applist_1}-->
		<div class="d-flex flex-wrap justify-content-center mb-3 ui-sortable">
			<!--{loop $applist_1 $key $value}-->
			<div class="popup-index-li" data-appid="$value[appid]" style="width:18rem;">
				<a class="card card-market m-2" href="$value[url]" <!--{if $value['open']}-->target="_blank"<!--{/if}--> title="$value[appname]">
					<div class="card-body text-truncate text-center">
						<div class="card-image">
							<img src="$value[appico]" alt="$value[appname]"/>
						</div>
						<span class="fs-4 text-dark">$value[appname]</span>
					</div>
					{eval $appdesc=$value['appdesc']?$value['appdesc']:lang('none');}
					<div class="card-footer text-truncate text-body" title="$appdesc">
						$appdesc
					</div>
				</a>
			</div>
			<!--{/loop}-->
		</div>
		<!--{/if}-->
		<footer class="text-center text-muted m-3">
			<!--{template lyear:copyright}-->
		</footer>
	</div>
</div>
</main>
<script type="text/javascript">
	jQuery(document).ready(function(){
		jQuery('.ui-sortable').sortable({
			placeholder: "ui-state-default",
			items: "div.popup-index-li",
			stop: function(event, ui) {
				var appids=[];
				jQuery('.popup-index-li').each(function(){
					appids.push(jQuery(this).data('appid'));
				});
				jQuery.post('{MOD_URL}&do=saveIndex',{"appids":appids});
			}
		});
	});
</script>
<script type="text/javascript" src="static/jquery/jquery-ui.js?{VERHASH}"></script>
<script>
	// 服务器时间初始化
	var serverTimestamp = '$servertime'; 
	
	// 客户端加载时间
	var clientTimestampAtLoad = Date.now();
	
	// 计算时间偏移量
	var timeOffset = serverTimestamp - clientTimestampAtLoad;
	
	// 获取当前服务器时间
	function getServerTime() {
		return new Date(Date.now() + timeOffset);
	}
	// 为IE添加String.prototype.padStart的polyfill
	if (!String.prototype.padStart) {
		String.prototype.padStart = function padStart(targetLength, padString) {
			targetLength = targetLength >> 0; //floor if number or convert non-number to 0;
			padString = String(typeof padString !== 'undefined' ? padString : ' ');
			if (this.length >= targetLength) {
				return String(this);
			} else {
				targetLength = targetLength - this.length;
				if (targetLength > padString.length) {
					padString += padString.repeat(targetLength / padString.length); //append to original to ensure we are longer than needed
				}
				return padString.slice(0, targetLength) + String(this);
			}
		};
	}

	// 为IE添加Array.from的polyfill
	if (!Array.from) {
		Array.from = (function() {
			var toStr = Object.prototype.toString;
			var isCallable = function(fn) {
				return typeof fn === 'function' || toStr.call(fn) === '[object Function]';
			};
			var toInteger = function(value) {
				var number = Number(value);
				if (isNaN(number)) { return 0; }
				if (number === 0 || !isFinite(number)) { return number; }
				return (number > 0 ? 1 : -1) * Math.floor(Math.abs(number));
			};
			var maxSafeInteger = Math.pow(2, 53) - 1;
			var toLength = function(value) {
				var len = toInteger(value);
				return Math.min(Math.max(len, 0), maxSafeInteger);
			};

			return function from(arrayLike, mapFn, thisArg) {
				var C = this;
				var items = Object(arrayLike);
				if (arrayLike == null) {
					throw new TypeError('Array.from requires an array-like object - not null or undefined');
				}
				var map = isCallable(mapFn) ? mapFn : void undefined;
				var T = thisArg;
				var len = toLength(items.length);
				var A = isCallable(C) ? Object(new C(len)) : new Array(len);
				var k = 0;
				var kValue;
				while (k < len) {
					kValue = items[k];
					if (map) {
						A[k] = typeof T === 'undefined' ? map(kValue, k) : map.call(T, kValue, k);
					} else {
						A[k] = kValue;
					}
					k += 1;
				}
				A.length = len;
				return A;
			};
		}());
	}

	$(document).ready(function() {
		// 时间格式和显示选项
		var showSeconds = true;
		var use24HourFormat = true;
		
		// 更新问候语
		function updateGreeting() {
			var now = getServerTime();
			var hour = now.getHours();
			var greeting = '';
			
			if (hour < 6) {
				greeting = '凌晨好！';
			} else if (hour < 9) {
				greeting = '早上好！';
			} else if (hour < 12) {
				greeting = '上午好！';
			} else if (hour < 14) {
				greeting = '中午好！';
			} else if (hour < 18) {
				greeting = '下午好！';
			} else if (hour < 22) {
				greeting = '晚上好！';
			} else {
				greeting = '夜深了！';
			}
			
			$('#greeting').text(greeting);
		}
		
		// 更新日期显示
		function updateDate() {
			var now = getServerTime();
			var options = {year: 'numeric', month: 'long', day: 'numeric' };
			var dateString = now.toLocaleDateString('zh-CN', options);
			var weekday = now.toLocaleDateString('zh-CN', { weekday: 'long' });
			$('#current-date').text(dateString);
			$('#weekday').text(weekday);
		}
		
		// 更新时间显示
		function updateTime() {
			var now = getServerTime();
			var hours = now.getHours();
			var minutes = now.getMinutes();
			var seconds = now.getSeconds();
			var ampm = '';
			
			// 12小时制转换
			if (!use24HourFormat) {
				ampm = hours >= 12 ? '下午' : '上午';
				hours = hours % 12;
				hours = hours ? hours : 12; // 0 应显示为 12
			}
			
			// 补零
			hours = hours.toString().padStart(2, '0');
			minutes = minutes.toString().padStart(2, '0');
			seconds = seconds.toString().padStart(2, '0');
			
			// 构建时间字符串
			var timeString = hours + ':' + minutes;
			if (showSeconds) {
				timeString += ':' + seconds;
			}
			if (!use24HourFormat) {
				timeString += ' ' + ampm;
			}
			
			// 应用到DOM
			$('#time').text(timeString);
		}
		
		// 计算并更新进度
		function updateProgress() {
			var now = getServerTime();
			
			// 日进度
			var startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
			var nextDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
			var dayProgress = ((now - startOfDay) / (nextDay - startOfDay)) * 100;
			var dayHours = Math.floor(dayProgress * 24 / 100);
			
			$('#day-hours').text(dayHours);
			$('#day-progress-bar').css('width', dayProgress + '%');
			$('#day-progress-text').text(Math.round(dayProgress) + '%');
			
			// 周进度
			var dayOfWeek = now.getDay() || 7; // 0为周日，转换为7
			var weekProgress = (dayOfWeek - 1 + dayProgress / 100) / 7 * 100;
			
			$('#week-days').text(dayOfWeek - 1);
			$('#week-progress-bar').css('width', weekProgress + '%');
			$('#week-progress-text').text(Math.round(weekProgress) + '%');
			
			// 月进度
			var startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
			var nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
			var monthProgress = ((now - startOfMonth) / (nextMonth - startOfMonth)) * 100;
			var daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
			var daysPassed = now.getDate() - 1 + dayProgress / 100;
			
			$('#month-days').text(Math.floor(daysPassed));
			$('#month-progress-bar').css('width', monthProgress + '%');
			$('#month-progress-text').text(Math.round(monthProgress) + '%');
			
			// 年进度
			var startOfYear = new Date(now.getFullYear(), 0, 1);
			var endOfYear = new Date(now.getFullYear() + 1, 0, 1);
			var yearProgress = ((now - startOfYear) / (endOfYear - startOfYear)) * 100;
			var monthsPassed = now.getMonth() + (now.getDate() / daysInMonth);
			
			$('#year-months').text(Math.floor(monthsPassed));
			$('#year-progress-bar').css('width', yearProgress + '%');
			$('#year-progress-text').text(Math.round(yearProgress) + '%');
		}
		
		// 初始化所有显示
		function initializeDisplay() {
			updateGreeting();
			updateDate();
			updateTime();
			updateProgress();
		}
		
		// 每秒更新时间
		setInterval(function() {
			updateTime();
		}, 1000);
		
		// 每分钟更新日期和进度
		setInterval(function() {
			updateDate();
			updateProgress();
		}, 60000);
		
		// 每小时更新问候语
		setInterval(updateGreeting, 3600000);
		
		// 初始化显示
		initializeDisplay();
		
		// 按钮事件处理
		$('#format-24h').click(function() {
			use24HourFormat = true;
			$(this).addClass('text-primary');
			$('#format-12h').removeClass('text-primary');
			updateTime();
		});
		
		$('#format-12h').click(function() {
			use24HourFormat = false;
			$(this).addClass('text-primary');
			$('#format-24h').removeClass('text-primary');
			updateTime();
		});
		
		$('#show-seconds').click(function() {
			showSeconds = !showSeconds;
			if (showSeconds) {
				$(this).html('<i class="mdi mdi-av-timer"></i>');
				$(this).attr('title', '显示秒');
			} else {
				$(this).html('<i class="mdi mdi-camera-timer"></i>');
				$(this).attr('title', '不显示秒');
			}
			updateTime();
		});
	});
</script>
<!--{template lyear:footer_simple}-->