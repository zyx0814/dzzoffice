<!--{if $_G['adminid'] == 1}-->
<script type="text/javascript">
    try {
        var openarr = $openarr;
    } catch (e) {
    }
    $.getScript('dzz/system/scripts/selorg.js?{VERHASH}', function () {
        selorg.openarr = openarr;
    });
</script>
<!--{/if}-->
<div class="card-body scroll-y">
    <form class="form-horizontal" action="{MOD_URL}&op=app&do=updatesetting" onsubmit="return submitsetting(this);">
		<div class="pb-1 border-bottom mb-3">
			<span class="border-start border-5 border-primary rounded ps-1"></span> 个人设置
		</div>
		<div class="row mb-3">
            <label class="col-sm-2">同名文件处理</label>
            <div class="col-sm-10">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="ondup1" name="explorermyset[ondup]" value="1" <!--{if $explorermyset['ondup']==1}-->checked<!--{/if}-->>
                <label class="form-check-label" for="ondup1">覆盖</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="ondup2" name="explorermyset[ondup]" value="0" <!--{if !$explorermyset['ondup']}-->checked<!--{/if}-->>
                <label class="form-check-label" for="ondup2">重命名</label>
              </div>
			  <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="ondup3" name="explorermyset[ondup]" value="2" <!--{if $explorermyset['ondup'] == 2}-->checked<!--{/if}-->>
                <label class="form-check-label" for="ondup3">跳过</label>
              </div>
			  <span class="form-text">上传文件时同名文件处理方式，该功能只对上传到Dzz生效，对网络挂载无效。</span>
            </div>
		</div>
		<div class="row mb-3">
            <label class="col-sm-2">显示模式</label>
            <div class="col-sm-10">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="iconview1" name="explorermyset[iconview]" value="1" <!--{if $explorermyset['iconview']==1}-->checked<!--{/if}-->>
                <label class="form-check-label" for="iconview1">适用于所有文件夹</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" id="iconview2" name="explorermyset[iconview]" value="0" <!--{if !$explorermyset['iconview']}-->checked<!--{/if}-->>
                <label class="form-check-label" for="iconview2">适用于单个文件夹</label>
              </div>
              <span class="form-text">为每个文件夹选择视图模式，或对所有文件夹使用相同的视图模式</span>
            </div>
		</div>
		<!--{if $_G['adminid'] == 1}-->
		<div class="pb-1 border-bottom mb-3">
			<span class="border-start border-5 border-primary rounded ps-1"></span> 网盘设置
		</div>
		<div class="row mb-1">
			<label class="col-sm-2" for="usermemory">{lang start_person_dir}</label>
			<div class="col-sm-10">
				<div class="form-check form-switch">
					<input type="checkbox" class="form-check-input" id="usermemory" name="setting[explorer_usermemoryOn]" <!--{if $setting['explorer_usermemoryOn']==1 || !isset($setting['explorer_organizationOn'])}-->checked<!--{/if}--> />
				</div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2"></label>
			<div class="col-sm-10">
				<div id="memoryinfo" <!--{if isset($setting['explorer_organizationOn']) && $setting['explorer_usermemoryOn'] == 0}-->class="hide"<!--{/if}--> >
					<div class="function-radio clearfix">
						<div class="form-check form-check-inline">
							<input type="radio" class="form-check-input" value="all" id="allsetting" name="setting[explorer_mermoryusersetting]" <!--{if !isset($setting['explorer_mermoryusersetting']) || $setting['explorer_mermoryusersetting'] == 'all'}-->checked<!--{/if}--> >
							<label class="form-check-label" for="allsetting">{lang all_personnel}</label>
						</div>
						<span class="form-text">{lang organizational_structure_generate_personal_storage}</span>
					</div>
					<div class="function-radio clearfix">
						<div class="form-check form-check-inline">
							<input type="radio" id="inputRadiosUnchecked" class="form-check-input" name="setting[explorer_mermoryusersetting]" value="appoint"
							<!--{if $setting['explorer_mermoryusersetting']=='appoint'}-->checked
							<!--{/if}--> >
							<label class="form-check-label" for="inputRadiosUnchecked">{lang designated_personnel_or_department_personnel}</label>
						</div>
					</div>
					<span class="form-text">{lang storage_designated_personnel_or_department_personnel}</span>
					<div class="selectorguser" <!--{if $setting['explorer_mermoryusersetting']!='appoint'}-->style="display:none"<!--{/if}-->>
						<div class="clearfix">
							<div class="d-flex" id="orgids">
								<!--{loop $result1['selOrg'] $value}-->
								<button id="orgids_sl_$value['orgid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg" data-val="$value['orgid']">
									{eval echo avatar_group($value['orgid'],null,'iconFirstWord');}
									$value[orgname] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('orgids',this);"></a>
								</button>
								<!--{/loop}-->
								<!--{loop $result1['selUser'] $value}-->
								<button id="orgids_sl_uid_$value['uid']" data-val="uid_$value['uid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg">
									{eval echo avatar_block($value['uid'],array($value['uid']=>$value['headerColor']),'iconFirstWord');} $value['username'] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('orgids',this);"></a>
								</button>
								<!--{/loop}-->
							</div>
							<input id="sel_orgids" name="setting[explorer_memoryorgusers]" type="hidden" value="$setting['explorer_memoryorgusers']"/>
						</div>
						<div class="dropdown">
							<a href="javascript:;" class="dropdown-toggle btn btn-primary" id="orgids_Menu" data-toggle="dropdown">{lang select_departments_or_users}</a>
							<div id="orgids_dropdown_menu" class="dropdown-menu org-sel-box" role="menu" aria-labelledby="orgids_Menu">
								<iframe name="orgids_iframe" class="org-sel-box-iframe" src="{DZZSCRIPT}?mod=system&op=orgtree&template=1&ctrlid=orgids&multiple=1&range=1" frameborder="0" marginheight="0" marginwidth="0" width="100%" height="100%" allowtransparency="true"></iframe>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2" for="explorer_organizationOn">{lang allow_use_org}</label>
			<div class="col-sm-10">
				<div class="form-check form-switch">
					<input type="checkbox" class="form-check-input" name="setting[explorer_organizationOn]" <!--{if (isset($setting['explorer_organizationOn']) && $setting['explorer_organizationOn']) || !isset($setting['explorer_organizationOn'])}-->checked<!--{/if}--> id="explorer_organizationOn" />
				  </div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2" for="explorer_groupOn">{lang allow_use_group}</label>
			<div class="col-sm-10">
				<div class="form-check form-switch">
					<input type="checkbox" class="form-check-input" name="setting[explorer_groupOn]" <!--{if (isset($setting['explorer_groupOn']) && $setting['explorer_groupOn']) || !isset($setting['explorer_groupOn'])}-->checked <!--{/if}--> id="explorer_groupOn" />
				  </div>
			</div>
		</div>
		<div class="row mb-1">
			<label class="col-sm-2" for="usercreatememory">{lang allow_create_group}</label>
			<div class="col-sm-10">
				<div class="form-check form-switch">
					<input type="checkbox" class="form-check-input" name="setting[explorer_groupcreate]" id="usercreatememory" <!--{if (isset($setting['explorer_groupcreate']) && $setting['explorer_groupcreate']) || !isset($setting['explorer_groupcreate'])}-->checked <!--{/if}--> />
				  </div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2"></label>
			<div class="col-sm-10">
				<div id="memorycreateinfo" <!--{if isset($setting['explorer_groupcreate']) && $setting['explorer_groupcreate'] == 0}-->class="hide"<!--{/if}--> >
					<div class="function-radio clearfix">
						<div class="form-check form-check-inline">
							<input type="radio" class="form-check-input" id="explorer_mermorygroupsetting1" value="all" name="setting[explorer_mermorygroupsetting]"<!--{if !isset($setting['explorer_mermorygroupsetting']) || $setting['explorer_mermorygroupsetting'] == 'all'}-->checked<!--{/if}--> >
							<label class="form-check-label" for="explorer_mermorygroupsetting1">{lang all_personnel}</label>
						</div>
						<span class="form-text">{lang allow_allcreate_group}。</span>
					</div>
					<div class="function-radio clearfix">
						<div class="form-check form-check-inline">
							<input type="radio" class="form-check-input" id="explorer_mermorygroupsetting2" name="setting[explorer_mermorygroupsetting]" value="appoint"<!--{if $setting['explorer_mermorygroupsetting']=='appoint'}-->checked<!--{/if}--> >
							<label class="form-check-label" for="explorer_mermorygroupsetting2">{lang designated_personnel_or_department_personnel}</label>
						</div>
						<span class="form-text">{lang allow_appointcreate_group}</span>
					</div>
					<div class="selectgroupuser"<!--{if $setting['explorer_mermorygroupsetting']!='appoint'}-->style="display:none;"<!--{/if}-->>
						<div class="clearfix">
							<div id="groupcreateids">
								<!--{loop $result2['selOrg'] $value}-->
								<button id="groupcreateids_sl_$value['orgid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg" data-val="$value['orgid']">
									{eval echo avatar_group($value['orgid'],null,'iconFirstWord');}
									$value[orgname] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('groupcreateids',this);"></a>
								</button>
								<!--{/loop}-->
								<!--{loop $result2['selUser'] $value}-->
								<button id="groupcreateids_sl_uid_$value['uid']" data-val="uid_$value['uid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg">
									{eval echo avatar_block($value['uid'],array($value['uid']=>$value['headerColor']),'iconFirstWord');}$value['username'] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('groupcreateids',this);"></a>
								</button>
								<!--{/loop}-->
							</div>
							<input id="sel_groupcreateids" name="setting[explorer_memorygroupusers]" type="hidden" value="$setting['explorer_memorygroupusers']"/>
						</div>
						<div class="dropdown">
							<a href="javascript:;" class="dropdown-toggle btn btn-primary" id="groupcreateids_Menu" data-toggle="dropdown">{lang select_departments_or_users}</a>
							<div class="dropdown-menu org-sel-box" role="menu" aria-labelledby="groupcreateids_Menu">
								<iframe name="groupcreateids_iframe" class="org-sel-box-iframe" src="{DZZSCRIPT}?mod=system&op=orgtree&ctrlid=groupcreateids&template=1&multiple=1&range=1" frameborder="0" marginheight="0" marginwidth="0" width="100%" height="100%" allowtransparency="true"></iframe>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2">群组成员选择</label>
			<div class="col-sm-10">
				<div class="form-check form-check-inline">
					<input type="radio" class="form-check-input" id="explorer_mermoryonlymyorg1" value="1" name="setting[explorer_mermoryonlymyorg]"<!--{if $setting['explorer_mermoryonlymyorg'] == '1'}-->checked<!--{/if}--> >
					<label class="form-check-label" for="explorer_mermoryonlymyorg1">所有机构部门</label>
				</div>
				<span class="form-text">可以选择全站所有成员</span>
				<div class="form-check form-check-inline">
					<input type="radio" class="form-check-input" id="explorer_mermoryonlymyorg2" value="0" name="setting[explorer_mermoryonlymyorg]"<!--{if !$setting['explorer_mermoryonlymyorg']}-->checked<!--{/if}--> >
					<label class="form-check-label" for="explorer_mermoryonlymyorg2">本机构部门</label>
				</div>
				<span class="form-text">仅可以选择用户所在部门成员或可管理的部门成员</span>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2" for="catcreatememory">{lang allow_create_cat}</label>
			<div class="col-sm-10">
				<div class="form-check form-switch">
					<input type="checkbox" class="form-check-input" name="setting[explorer_catcreate]" id="catcreatememory" <!--{if (isset($setting['explorer_catcreate']) && $setting['explorer_catcreate']) || !isset($setting['explorer_catcreate'])}-->checked <!--{/if}--> />
				  </div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2">开启网盘挂载</label>
			<div class="col-sm-10">
				<div class="function-radio clearfix">
					<div class="form-check form-check-inline">
						<input type="radio" class="form-check-input" value="all" id="cloudsetting" name="setting[explorer_mermorycloudsetting]" <!--{if !isset($setting['explorer_mermorycloudsetting']) || $setting['explorer_mermorycloudsetting'] == 'all'}-->checked<!--{/if}--> >
						<label class="form-check-label" for="cloudsetting">{lang all_personnel}</label>
					</div>
					<span class="form-text">允许所有成员使用网盘挂载。</span>
				</div>
				<div class="function-radio clearfix">
					<div class="form-check form-check-inline">
						<input type="radio" id="mermorycloudsetting" class="form-check-input" name="setting[explorer_mermorycloudsetting]" value="appoint"
						<!--{if $setting['explorer_mermorycloudsetting']=='appoint'}-->checked
						<!--{/if}--> >
						<label class="form-check-label" for="mermorycloudsetting">{lang designated_personnel_or_department_personnel}</label>
					</div>
				</div>
				<span class="form-text">仅为指定的人员或部门人员可以使用网盘挂载，未指定人员表示关闭网盘挂载功能。</span>
				<div class="selectclouduser" <!--{if $setting['explorer_mermorycloudsetting']!='appoint'}-->style="display:none"<!--{/if}-->>
					<div class="clearfix">
						<div class="d-flex" id="cloudorgids">
							<!--{loop $result3['selOrg'] $value}-->
							<button id="cloudorgids_sl_$value['orgid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg" data-val="$value['orgid']">
								{eval echo avatar_group($value['orgid'],null,'iconFirstWord');}
								$value[orgname] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('cloudorgids',this);"></a>
							</button>
							<!--{/loop}-->
							<!--{loop $result3['selUser'] $value}-->
							<button id="cloudorgids_sl_uid_$value['uid']" data-val="uid_$value['uid']" type="button" class="btn btn-outline-primary btn-sm btn-sorg">
								{eval echo avatar_block($value['uid'],array($value['uid']=>$value['headerColor']),'iconFirstWord');} $value['username'] <a href="javascript:;" class="mdi mdi-close-circle lead" title="{lang delete}" onclick="selorg.remove('cloudorgids',this);"></a>
							</button>
							<!--{/loop}-->
						</div>
						<input id="sel_cloudorgids" name="setting[explorer_memorycloudusers]" type="hidden" value="$setting['explorer_memorycloudusers']"/>
					</div>
					<div class="dropdown">
						<a href="javascript:;" class="dropdown-toggle btn btn-primary" id="cloudorgids_Menu" data-toggle="dropdown">{lang select_departments_or_users}</a>
						<div id="cloudorgids_dropdown_menu" class="dropdown-menu org-sel-box" role="menu" aria-labelledby="cloudorgids_Menu">
							<iframe name="cloudorgids_iframe" class="org-sel-box-iframe" src="{DZZSCRIPT}?mod=system&op=orgtree&template=1&ctrlid=cloudorgids&multiple=1&range=1" frameborder="0" marginheight="0" marginwidth="0" width="100%" height="100%" allowtransparency="true"></iframe>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2" for="textnumber">{lang finally_delete_setting}</label>
			<div class="col-sm-10">
				<div class="input-group mb-3">
                  <input type="text" class="form-control" name="setting[explorer_finallydelete]" onblur="checks()" id="textnumber" <!--{if isset($setting['explorer_finallydelete'])}-->value="{$setting[explorer_finallydelete]}"<!--{else}-->value="-1"<!--{/if}-->/>
                  <span class="input-group-text">天</span>
                </div>
				<ul class="form-text">
					<li>{lang explorer_finallydelete_text}</li>
					<li class="text-danger">是否会自动删除文件取决于系统工具-计划任务中的回收站自动删除任务是否执行。</li>
					<li><={lang explorer_finallydelete_one}</li>
					<li>={lang explorer_finallydelete_zreo}</li>
					<li>>{lang explorer_finallydelete_two}</li>
				</ul>
			</div>
		</div>
		<div class="row mb-3">
			<label class="col-sm-2" for="explorer_limitConcurrentUploads">上传并发线程</label>
			<div class="col-sm-10">
				<div class="input-group mb-3">
                  <input type="text" class="form-control" name="setting[explorer_limitConcurrentUploads]" id="explorer_limitConcurrentUploads" <!--{if isset($setting['explorer_limitConcurrentUploads'])}-->value="{$setting[explorer_limitConcurrentUploads]}"<!--{else}-->value="3"<!--{/if}-->/>
                  <span class="input-group-text">个</span>
                </div>
				<span class="form-text">设置文件上传时并发数量，不支持文件夹并发上传</span>
			</div>
		</div>
		<!--{/if}-->
		<dl class="mb-3 d-grid">
            <input type="submit" value="{lang affirm}" class="btn btn-primary btn-round bodyloading"/>
          </dl>
	</form>
</div>

<script type="text/javascript" reload="1">
var recylenum = true;
//input框只能输入数字
function checks(){
	var value=jQuery('#textnumber').val();
	reg=/^-?\d+$/;
	if(reg.test(value)==true){
		$('.number').hide();
        recylenum = true;
	}else{
		$('.number').show();
        recylenum = false;
	}
	return false;
}

    //个人创建群组开关
    $('#usercreatememory').change(function () {
        if ($(this).prop('checked')) {
            $('#memorycreateinfo').removeClass('hide');
        } else {
            $('#memorycreateinfo').addClass('hide');
        }
    })

    //个人存储开关
    $('#usermemory').change(function () {
        if ($(this).prop('checked')) {
            $('#memoryinfo').removeClass('hide');
            //$('#usermemory_value').val(1);
        } else {
            $('#memoryinfo').addClass('hide');
            //$('#usermemory_value').val(0);
        }
    })

    //机构人员选择框切换
    $('.function-radio').find('input[name="setting[explorer_mermorygroupsetting]"]').change(function () {
        var val = $(this).val();
        if (val == 'appoint') {
            $('div.selectgroupuser').show();
        } else {
            $('div.selectgroupuser').hide();
        }
    })
    $('.function-radio').find('input[name="setting[explorer_mermoryusersetting]"]').change(function () {
        var val = $(this).val();
        if (val == 'appoint') {
            $('div.selectorguser').show();
        } else {
            $('div.selectorguser').hide();
        }
    })
	$('.function-radio').find('input[name="setting[explorer_mermorycloudsetting]"]').change(function () {
        var val = $(this).val();
        if (val == 'appoint') {
            $('div.selectclouduser').show();
        } else {
            $('div.selectclouduser').hide();
        }
    })
    //版本数量设置框切换
    $('#fileversion').change(function () {
        if ($(this).prop('checked')) {
            $('#fileversionnum').removeClass('hide');
            //$(this).val(1);
        } else {
            $('#fileversionnum').addClass('hide');
            $('#fileVersionNumber').val(0);
            //$(this).val(0);
        }
    })
    function submitsetting(form) {
    	if(!recylenum) return false;
        $.post(form.action, jQuery(form).serialize(), function (data) {
            if (data['success']) {
				layer.alert(data['msg']+'{lang page_automatically_updated_after_three_seconds}');
                setTimeout(function () {
                    location.reload();
                }, 3000)
            } else {
				layer.alert(data['msg'], {skin:'lyear-skin-danger'});
            }
        }, 'json').fail(function (jqXHR, textStatus, errorThrown) {
            showmessage('{lang do_failed}', 'error', 3000, 1);
        });
        return false;
    }
</script>